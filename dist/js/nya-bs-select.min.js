/**
 * nya-bootstrap-select v2.0.0
 * Copyright 2014 Nyasoft
 * Licensed under MIT license
 */
!function(){"use strict";function a(){return++i}function b(a){return a&&a.window===a}function c(a){return"string"==typeof a}function d(a){if(null==a||b(a))return!1;var d=a.length;return 1===a.nodeType&&d?!0:c(a)||Array.isArray(a)||0===d||"number"==typeof d&&d>0&&d-1 in a}function e(){return Object.create(null)}function f(b,c){var d,e=typeof b;return"function"==e||"object"==e&&null!==b?"function"==typeof(d=b.$$hashKey)?d=b.$$hashKey():void 0===d&&(d=b.$$hashKey=(c||a)()):d=b,e+":"+d}function g(a,b,c){var d,e,f=[],g=[];for(d=0;d<b.length;d++)for(e=0;e<a.length;e++)a[e][c]?a[e][c]===b[d]&&g.push(a[e]):f.push(a[e]);return g=g.concat(f)}function h(a){var b=a[0],c=a[a.length-1],d=[b];do{if(b=b.nextSibling,!b)break;d.push(b)}while(b!==c);return angular.element(d)}var i=0,j=function(a){return a.clone[0]},k=function(a){return a.clone[a.clone.length-1]},l=function(a,b,c,d,e,f,g,h){a[c]=d,e&&(a[e]=f),a.$index=b,a.$first=0===b,a.$last=b===g-1,a.$middle=!(a.$first||a.$last),a.$odd=!(a.$even=0===(1&b)),h&&(a.$group=h)},m=function(a,b){var c,d=a.length;if(0===d)return!1;for(c=0;d>c;c++)if(o(b,a[c]))return!0;return!1},n=angular.element,o=angular.equals,p=angular.copy,q=angular.module("nya.bootstrap.select",[]);q.controller("nyaBsSelectCtrl",function(){var a=this;a.keyIdentifier=null,a.valueIdentifier=null,a.isMultiple=!1,a.onCollectionChange=function(){}}),q.directive("nyaBsSelect",["$parse","$document","$timeout",function(a,b,c){var d="Nothing selected",e='<button class="btn btn-default dropdown-toggle"><span class="pull-left filter-option"></span>&nbsp;<span class="caret"></span></button>',f='<div class="dropdown-menu open"></div>',g='<div class="bs-searchbox"><input type="text" class="form-control"></div>',h='<ul class="dropdown-menu inner"></ul>',i='<li class="no-search-result"><span>NO SEARCH RESULT</span></li>',j=function(a,b,c){var d,e=a,f=typeof c;if(a==b)return null;do if("string"===f){if(d=" "+e.className+" ",1===e.nodeType&&d.replace(/[\t\r\n\f]/g," ").indexOf(c)>=0)return e}else if(e==c)return e;while((e=e.parentNode)&&e!=b&&9!==e.nodeType);return null},k=function(a){var b,c=a.className.replace(/[\t\r\n\f]/g," ").trim();b=c.split(" ");for(var d=0;d<b.length;d++)/\s+/.test(b[d])&&(b.splice(d,1),d--);return b},l=function(a,b){var c,d,e;if(-1!==a.text().toLowerCase().indexOf(b.toLowerCase()))return!0;for(c=a.children(),e=c.length,d=0;e>d;d++)if(-1!==c.eq(d).text().toLowerCase().indexOf(b.toLowerCase()))return!0;return!1};return{restrict:"ECA",require:["ngModel","nyaBsSelect"],controller:"nyaBsSelectCtrl",compile:function(q,r){q.addClass("btn-group");var s,t,u,v=q.children(),w=n(e),x=n(f),y=n(h);u=k(q[0]),u.forEach(function(a){/btn-(?:primary)|(?:info)|(?:success)|(?:warning)|(?:danger)|(?:inverse)/.test(a)&&(q.removeClass(a),w.removeClass("btn-default"),w.addClass(a)),/btn-(?:lg)|(?:sm)|(?:xs)/.test(a)&&(tELement.removeClass(a),w.addClass(a)),(a="form-control")&&w.addClass(a)}),y.append(v);var z="undefined"!=typeof r.multiple;return"true"===r.liveSearch&&(s=n(g),t=n(i),x.append(s),y.append(t)),w.children().eq(0).text(r.title?r.title:d),x.append(y),q.append(w),q.append(x),function(e,f,g,h){function i(a){var b;return r?(b=a.scope(),r(b)):v.valueIdentifier||v.keyIdentifier?(b=a.scope(),b[v.valueIdentifier]||b[v.keyIdentifier]):a.attr("value")}function k(a){var b=a.find("a");return b.children().eq(0).hasClass("check-mark")?b[0].firstChild.cloneNode(!1):b.children().eq(0)[0].cloneNode(!0)}function q(){var a=u.$modelValue,b=w.children().eq(0);a&&(z&&0===a.length?g.title?(b.empty(),b.append(document.createTextNode(g.title))):(b.empty(),b.append(document.createTextNode(d))):c(function(){var c,e,f,h,j,l,n=y.children(),p=n.length,q=[];if(z&&"count"===g.selectedTextFormat?l=1:z&&g.selectedTextFormat&&(j=g.selectedTextFormat.match(/\s*count\s*>\s*(\d+)\s*/))&&(l=parseInt(j[1],10)),"undefined"!=typeof l&&a.length>l)return b.empty(),void b.append(document.createTextNode(a.length+" items selected"));for(f=0;p>f;f++)e=n.eq(f),e.hasClass("nya-bs-option")&&(c=i(e),z?Array.isArray(a)&&m(a,c)&&(h=e.attr("title"),q.push(h?document.createTextNode(h):k(e))):o(a,c)&&(h=e.attr("title"),q.push(h?document.createTextNode(h):k(e))));if(0===q.length)g.title?(b.empty(),b.append(document.createTextNode(g.title))):(b.empty(),b.append(document.createTextNode(d)));else if(1===q.length)b.empty(),b.append(q[0]);else for(b.empty(),f=0;f<q.length;f++)b.append(q[f]),f<q.length-1&&b.append(document.createTextNode(", "))}))}var r,u=h[0],v=h[1],x=a(v.valueExp);v.valueExp&&(r=function(a,b){return x(a,b)}),z&&(v.isMultiple=!0),v.onCollectionChange=function(a){console.log("collection changed! ",a);var b,c,d=[],f=u.$modelValue;if(f){if(a&&0!==a.length){if(r)for(b=0;b<a.length;b++)d.push(r(e,a[b]));else for(b=0;b<a.length;b++)v.valueIdentifier?d.push(a[b][v.valueIdentifier]):v.keyIdentifier&&d.push(a[b][v.keyIdentifier]);if(z){for(c=f.length,b=0;b<f.length;b++)m(d,f[b])||(f.splice(b,1),b--);c!==f.length&&(f=p(f))}else m(d,f)||(f=d[0])}else f=z?[]:null;u.$setViewValue(f),q()}},y.on("click",function(a){if(!n(a.target).hasClass("dropdown-header")){var b,c,d,g,h=j(a.target,y[0],"nya-bs-option"),k=u.$modelValue;if(null!==h){if(b=n(h),b.hasClass("disabled"))return;c=i(b),c&&(z?(d=Array.isArray(k)?p(k):[],g=d.indexOf(c),-1===g?(d.push(c),b.addClass("selected")):(d.splice(g,1),b.removeClass("selected"))):(y.children().removeClass("selected"),d=c,b.addClass("selected")),u.$setViewValue(d),e.$digest()),z||f.removeClass("open"),q()}}}),b.on("click",function(a){null===j(a.target,f.parent()[0],f[0])&&f.removeClass("open")}),w.on("click",function(){f.toggleClass("open"),"true"===g.liveSearch&&f.hasClass("open")&&s.children().eq(0)[0].focus()}),"true"===g.liveSearch&&s.children().on("input",function(){var a,b,c=s.children().val(),d=0,e=y.children(),f=e.length;if(c){for(a=0;f>a;a++)b=e.eq(a),b.hasClass("nya-bs-option")&&(l(b.find("a"),c)?(b.removeClass("not-match"),d++):b.addClass("not-match"));0===d?t.addClass("show"):t.removeClass("show")}else{for(a=0;f>a;a++)b=e.eq(a),b.hasClass("nya-bs-option")&&b.removeClass("not-match");t.removeClass("show")}}),u.$render=function(){console.log(f.attr("id")+" render");var a,b,c=u.$modelValue,d=y.children(),e=d.length;if("undefined"==typeof c)for(a=0;e>a;a++)d.eq(a).hasClass("nya-bs-option")&&d.eq(a).removeClass("selected");else for(a=0;e>a;a++)d.eq(a).hasClass("nya-bs-option")&&(b=i(d.eq(a)),z?m(c,b)?d.eq(a).addClass("selected"):d.eq(a).removeClass("selected"):o(c,b)?d.eq(a).addClass("selected"):d.eq(a).removeClass("selected"));q()}}}}}]),q.directive("nyaBsOption",["$parse",function(a){var b=/^\s*(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/;return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,require:["^nyaBsSelect","^ngModel"],compile:function(c,i){var p=i.nyaBsOption,q=document.createComment(" end nyaBsOption: "+p+" "),r=p.match(b);if(!r)throw new Error("invalid expression");var s,t,u,v,w,x=i.value,y=x?a(x):null,z=r[3]||r[1],A=r[2],B=r[4],C=r[5]?a(r[5]):null,D=r[6],E={$id:f},F={};return D?v=a(D):(s=function(a,b){return f(b)},t=function(a){return a}),function(a,b,c,f,i){console.log("nya-bs-option link called");var p,r=f[0],D=f[1],G={};v&&(u=function(b,c,d){return A&&(E[A]=b),E[z]=c,E.$index=d,v(a,E)}),C&&(w=function(b,c){return A&&(F[A]=b),F[z]=c,C(a,F)}),A&&(r.keyIdentifier=A),z&&(r.valueIdentifier=z),y&&(r.valueExp=x,p=function(b,c){return A&&(G[A]=b),G[z]=c,y(a,G)});var H=e();a.$watchCollection(B,function(a){var c,f,v,x,y,B,C,E,F,G,I,J,K,L,M=b[0],N=e(),O=[];if(w&&(J=[]),d(a))B=a,y=u||s;else{y=u||t,B=[];for(var P in a)a.hasOwnProperty(P)&&"$"!=P.charAt(0)&&B.push(P);B.sort()}for(C=B.length,E=new Array(C),c=0;C>c;c++)if(f=a===B?c:B[c],v=a[f],x=y(f,v,c),L={},A&&(L[A]=f),L[z]=v,O.push(L),w&&(G=w(f,v),-1===J.indexOf(G)&&G&&J.push(G)),H[x])F=H[x],delete H[x],w&&(F.group=G),F.key=f,F.value=v,N[x]=F,E[c]=F;else{if(N[x])throw E.forEach(function(a){a&&a.scope&&(H[a.id]=a)}),new Error("Duplicates in a select are not allowed. Use 'track by' expression to specify unique keys.");E[c]={id:x,scope:void 0,clone:void 0,key:f,value:v},N[x]=!0,G&&(E[c].group=G)}console.log("nextBlockOrder: ",E,"group: ",J),J&&J.length>0&&(E=g(E,J,"group")),console.log("nextBlockOrder: ",E,"collectionLength: ",C);for(var Q in H)F=H[Q],h(F.clone).remove(),F.scope.$destroy();for(c=0;C>c;c++)F=E[c],F.scope?(I=M,j(F)!=I&&n(M).after(F.clone),M=k(F),l(F.scope,c,z,F.value,A,F.key,C,F.group)):(i(function(a,b){F.scope=b;var d=q.cloneNode(!1);a[a.length++]=d,n(M).after(a),a.addClass("nya-bs-option"),v=p?p(F.key,F.value):F.value||F.key,r.isMultiple?Array.isArray(D.$modelvalue)&&m(D.$modelValue,v)&&a.addClass("selected"):o(v,D.$modelValue)&&a.addClass("selected"),M=d,F.clone=a,N[F.id]=F,l(F.scope,c,z,F.value,A,F.key,C,F.group)}),J&&(K&&K===F.group||F.clone.addClass("first-in-group"),K=F.group,F.clone.addClass("group-item")));H=N,r.onCollectionChange(O)})}}}}])}();