/**
 * nya-bootstrap-select v2.0.0
 * Copyright 2014 Nyasoft
 * Licensed under MIT license
 */
!function(){"use strict";function a(){return++i}function b(a){return a&&a.window===a}function c(a){return"string"==typeof a}function d(a){if(null==a||b(a))return!1;var d=a.length;return 1===a.nodeType&&d?!0:c(a)||Array.isArray(a)||0===d||"number"==typeof d&&d>0&&d-1 in a}function e(){return Object.create(null)}function f(b,c){var d,e=typeof b;return"function"==e||"object"==e&&null!==b?"function"==typeof(d=b.$$hashKey)?d=b.$$hashKey():void 0===d&&(d=b.$$hashKey=(c||a)()):d=b,e+":"+d}function g(a,b,c){var d,e,f=[],g=[];for(d=0;d<b.length;d++)for(e=0;e<a.length;e++)a[e][c]?a[e][c]===b[d]&&g.push(a[e]):f.push(a[e]);return g=g.concat(f)}function h(a){var b=a[0],c=a[a.length-1],d=[b];do{if(b=b.nextSibling,!b)break;d.push(b)}while(b!==c);return angular.element(d)}var i=0,j=function(a){return a.clone[0]},k=function(a){return a.clone[a.clone.length-1]},l=function(a,b,c,d,e,f,g,h){a[c]=d,e&&(a[e]=f),a.$index=b,a.$first=0===b,a.$last=b===g-1,a.$middle=!(a.$first||a.$last),a.$odd=!(a.$even=0===(1&b)),h&&(a.$group=h)},m=function(a,b){var c,d=a.length;if(0===d)return!1;for(c=0;d>c;c++)if(s(b,a[c]))return!0;return!1},n=function(a,b){var c,d=a.length;if(0===d)return-1;for(c=0;d>c;c++)if(s(b,a[c]))return c;return-1},o=function(a,b,c){var d,e=a,f=typeof c;if(a==b)return null;do if("string"===f){if(d=" "+e.className+" ",1===e.nodeType&&d.replace(/[\t\r\n\f]/g," ").indexOf(c)>=0)return e}else if(e==c)return e;while((e=e.parentNode)&&e!=b&&9!==e.nodeType);return null},p=function(a){var b,c=a.className.replace(/[\t\r\n\f]/g," ").trim();b=c.split(" ");for(var d=0;d<b.length;d++)/\s+/.test(b[d])&&(b.splice(d,1),d--);return b},q=function(a,b){var c,d,e;if(-1!==a.text().toLowerCase().indexOf(b.toLowerCase()))return!0;for(c=a.children(),e=c.length,d=0;e>d;d++)if(-1!==c.eq(d).text().toLowerCase().indexOf(b.toLowerCase()))return!0;return!1},r=angular.element,s=angular.equals,t=angular.copy,u=angular.module("nya.bootstrap.select",[]);u.controller("nyaBsSelectCtrl",function(){var a=this;a.keyIdentifier=null,a.valueIdentifier=null,a.isMultiple=!1,a.onCollectionChange=function(){},a.setId=function(b){a.id=b||"id#"+Math.floor(1e4*Math.random())}}),u.directive("nyaBsSelect",["$parse","$document","$timeout",function(a,b,c){var d="Nothing selected",e='<button class="btn btn-default dropdown-toggle"><span class="pull-left filter-option"></span>&nbsp;<span class="caret"></span></button>',f='<div class="dropdown-menu open"></div>',g='<div class="bs-searchbox"><input type="text" class="form-control"></div>',h='<ul class="dropdown-menu inner"></ul>',i='<li class="no-search-result"><span>NO SEARCH RESULT</span></li>';return{restrict:"ECA",require:["ngModel","nyaBsSelect"],controller:"nyaBsSelectCtrl",compile:function(j,k){j.addClass("btn-group");var l,u,v,w=j.children(),x=r(e),y=r(f),z=r(h);v=p(j[0]),v.forEach(function(a){/btn-(?:primary)|(?:info)|(?:success)|(?:warning)|(?:danger)|(?:inverse)/.test(a)&&(j.removeClass(a),x.removeClass("btn-default"),x.addClass(a)),/btn-(?:lg)|(?:sm)|(?:xs)/.test(a)&&(tELement.removeClass(a),x.addClass(a)),(a="form-control")&&x.addClass(a)}),z.append(w);var A="undefined"!=typeof k.multiple;return"true"===k.liveSearch&&(l=r(g),u=r(i),y.append(l),z.append(u)),x.children().eq(0).text(k.title?k.title:d),y.append(z),j.append(x),j.append(y),function(e,f,g,h){function i(a){var b;return B?(b=a.scope(),B(b)):y.valueIdentifier||y.keyIdentifier?(b=a.scope(),b[y.valueIdentifier]||b[y.keyIdentifier]):a.attr("value")}function j(a){var b=a.find("a");return 0===b.children().length||b.children().eq(0).hasClass("check-mark")?b[0].firstChild.cloneNode(!1):b.children().eq(0)[0].cloneNode(!0)}function k(){var a=w.$modelValue,b=x.children().eq(0);a&&(A&&0===a.length?g.title?(b.empty(),b.append(document.createTextNode(g.title))):(b.empty(),b.append(document.createTextNode(d))):c(function(){var c,e,f,h,k,l,n=z.children(),o=n.length,p=[];if(A&&"count"===g.selectedTextFormat?l=1:A&&g.selectedTextFormat&&(k=g.selectedTextFormat.match(/\s*count\s*>\s*(\d+)\s*/))&&(l=parseInt(k[1],10)),"undefined"!=typeof l&&a.length>l)return b.empty(),void b.append(document.createTextNode(a.length+" items selected"));for(f=0;o>f;f++)e=n.eq(f),e.hasClass("nya-bs-option")&&(c=i(e),A?Array.isArray(a)&&m(a,c)&&(h=e.attr("title"),p.push(h?document.createTextNode(h):j(e))):s(a,c)&&(h=e.attr("title"),p.push(h?document.createTextNode(h):j(e))));if(0===p.length)g.title?(b.empty(),b.append(document.createTextNode(g.title))):(b.empty(),b.append(document.createTextNode(d)));else if(1===p.length)b.empty(),b.append(p[0]);else for(b.empty(),f=0;f<p.length;f++)b.append(p[f]),f<p.length-1&&b.append(document.createTextNode(", "))}))}function p(){var a,b,c=z.find("li"),d=c.length;for(b=0;d>b;b++)if(a=c.eq(b),a.hasClass("nya-bs-option")||a.attr("nya-bs-option")){v=a[0].clientHeight,console.log("liHeight",v);break}if(/\d+/.test(g.size)){var e=parseInt(g.size,10);z.css("max-height",e*v+"px"),z.css("overflow-y","auto")}}var v,w=h[0],y=h[1];y.setId(f.attr("id")),A&&(w.$isEmpty=function(a){return!a||0===a.length});var B,C=a(y.valueExp);y.valueExp&&(B=function(a,b){return C(a,b)}),A&&(y.isMultiple=!0),y.onCollectionChange=function(a){console.log("collection changed! ",a);var b,c,d=[],f=w.$modelValue;if(f){if(a&&0!==a.length){if(B)for(b=0;b<a.length;b++)d.push(B(e,a[b]));else for(b=0;b<a.length;b++)y.valueIdentifier?d.push(a[b][y.valueIdentifier]):y.keyIdentifier&&d.push(a[b][y.keyIdentifier]);if(A){for(c=f.length,b=0;b<f.length;b++)m(d,f[b])||(f.splice(b,1),b--);c!==f.length&&(f=t(f))}else m(d,f)||(f=d[0])}else f=A?[]:null;w.$setViewValue(f),k()}},z.on("click",function(a){if(!r(a.target).hasClass("dropdown-header")){var b,c,d,g,h=o(a.target,z[0],"nya-bs-option"),j=w.$modelValue;if(null!==h){if(b=r(h),b.hasClass("disabled"))return;c=i(b),c&&(A?(d=Array.isArray(j)?t(j):[],g=n(d,c),-1===g?(d.push(c),b.addClass("selected")):(d.splice(g,1),b.removeClass("selected"))):(z.children().removeClass("selected"),d=c,b.addClass("selected")),w.$setViewValue(d),e.$digest()),A||f.removeClass("open"),k()}}}),b.on("click",function(a){null===o(a.target,f.parent()[0],f[0])&&f.removeClass("open")}),x.on("click",function(){f.toggleClass("open"),f.hasClass("open")&&"undefined"==typeof v&&p(),"true"===g.liveSearch&&f.hasClass("open")&&l.children().eq(0)[0].focus()}),"true"===g.liveSearch&&l.children().on("input",function(){var a,b,c=l.children().val(),d=0,e=z.children(),f=e.length;if(c){for(a=0;f>a;a++)b=e.eq(a),b.hasClass("nya-bs-option")&&(q(b.find("a"),c)?(b.removeClass("not-match"),d++):b.addClass("not-match"));0===d?u.addClass("show"):u.removeClass("show")}else{for(a=0;f>a;a++)b=e.eq(a),b.hasClass("nya-bs-option")&&b.removeClass("not-match");u.removeClass("show")}}),w.$render=function(){console.log(y.id+" render start"," ngModel: ",w.$modelValue);var a,b,c=w.$modelValue,d=z.children(),e=d.length;if("undefined"==typeof c)for(a=0;e>a;a++)d.eq(a).hasClass("nya-bs-option")&&d.eq(a).removeClass("selected");else for(a=0;e>a;a++)d.eq(a).hasClass("nya-bs-option")&&(b=i(d.eq(a)),A?m(c,b)?d.eq(a).addClass("selected"):d.eq(a).removeClass("selected"):s(c,b)?d.eq(a).addClass("selected"):d.eq(a).removeClass("selected"));console.log(y.id+" render end"),k()}}}}}]),u.directive("nyaBsOption",["$parse",function(a){var b=/^\s*(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/;return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,require:["^nyaBsSelect","^ngModel"],compile:function(c,i){var n=i.nyaBsOption,o=document.createComment(" end nyaBsOption: "+n+" "),p=n.match(b);if(!p)throw new Error("invalid expression");var q,t,u,v,w,x=i.value,y=x?a(x):null,z=p[3]||p[1],A=p[2],B=p[4],C=p[5]?a(p[5]):null,D=p[6],E={$id:f},F={};return D?v=a(D):(q=function(a,b){return f(b)},t=function(a){return a}),function(a,b,c,f,i){var n,p=f[0],D=f[1],G={};v&&(u=function(b,c,d){return A&&(E[A]=b),E[z]=c,E.$index=d,v(a,E)}),C&&(w=function(b,c){return A&&(F[A]=b),F[z]=c,C(a,F)}),A&&(p.keyIdentifier=A),z&&(p.valueIdentifier=z),y&&(p.valueExp=x,n=function(b,c){return A&&(G[A]=b),G[z]=c,y(a,G)});var H=e();a.$watchCollection(B,function(a){console.log(p.id+" option watch start"," ngModel: ",D.$modelValue);var c,f,v,x,y,B,C,E,F,G,I,J,K,L,M=b[0],N=e(),O=[];if(w&&(J=[]),d(a))B=a,y=u||q;else{y=u||t,B=[];for(var P in a)a.hasOwnProperty(P)&&"$"!=P.charAt(0)&&B.push(P);B.sort()}for(C=B.length,E=new Array(C),c=0;C>c;c++)if(f=a===B?c:B[c],v=a[f],x=y(f,v,c),L={},A&&(L[A]=f),L[z]=v,O.push(L),w&&(G=w(f,v),-1===J.indexOf(G)&&G&&J.push(G)),H[x])F=H[x],delete H[x],w&&(F.group=G),F.key=f,F.value=v,N[x]=F,E[c]=F;else{if(N[x])throw E.forEach(function(a){a&&a.scope&&(H[a.id]=a)}),new Error("Duplicates in a select are not allowed. Use 'track by' expression to specify unique keys.");E[c]={id:x,scope:void 0,clone:void 0,key:f,value:v},N[x]=!0,G&&(E[c].group=G)}J&&J.length>0&&(E=g(E,J,"group"));for(var Q in H)F=H[Q],h(F.clone).remove(),F.scope.$destroy();for(c=0;C>c;c++)F=E[c],F.scope?(I=M,j(F)!=I&&r(M).after(F.clone),M=k(F),l(F.scope,c,z,F.value,A,F.key,C,F.group)):i(function(a,b){F.scope=b;var d=o.cloneNode(!1);a[a.length++]=d,r(M).after(a),a.addClass("nya-bs-option"),v=n?n(F.key,F.value):F.value||F.key,p.isMultiple?Array.isArray(D.$modelValue)&&m(D.$modelValue,v)&&a.addClass("selected"):s(v,D.$modelValue)&&a.addClass("selected"),M=d,F.clone=a,N[F.id]=F,l(F.scope,c,z,F.value,A,F.key,C,F.group)}),J&&(K&&K===F.group?F.clone.removeClass("first-in-group"):F.clone.addClass("first-in-group"),K=F.group,F.clone.addClass("group-item"));console.log(p.id+" option watch finished"),H=N,p.onCollectionChange(O)})}}}}])}();